---
title: "Network evaluation summary"
output:
 html_document:
   code_folding: hide
   fig_caption: yes
   highlight: zenburn
   self_contained: yes
   theme: cerulean
   toc: yes
   toc_depth: 2
   toc_float: yes
   number_sections: true
 word_document: default
 pdf_document:
   fig_caption: yes
   highlight: zenburn
   toc: yes
   toc_depth: 3
date: '`r Sys.Date()`'
author: 'Claire Rioualen'
params:
  predictions_dir: !r predictions_dir
  results_dir: !r results_dir
  # id: !r pos_set_id
  # discarded: !r discarded_tfs
---

<style type="text/css">

body{ /* Normal  */
      font-size: 14px;
  }
</style>

```{r setup, eval=TRUE, echo=FALSE, results='hide', include=FALSE, warnings=FALSE}
Sys.getenv("PATH")
knitr::opts_chunk$set(echo=FALSE, include=TRUE, warning=FALSE, message=FALSE, results = 'asis', fig.width = 10, fig.height = 6)

library(DT)
#library(dplyr)
#library(eulerr)
#library(ggplot2)
library(htmltools)
library(kableExtra)
#library(UpSetR)
```

This report is generated by the `NetworkEval` R package. Its purpose is to evaluate the accuracy of predicted TF-gene interactions, by comparing them against a set of positive and negative regulatory interactions (RIs) generated using various strategies. 

# Summary

## Summary table

```{r get-summary, eval=TRUE}
summary_df <- read.delim(paste0(params$results_dir, "/summary_report/summary_table.tsv"))
datatable(summary_df, rownames= FALSE, options = list(searching = FALSE, pageLength = 25)) %>% 
  formatCurrency(c("RIs_input", "RIs_TFfiltered", "RIs_RIfiltered", "TP", "FP"), currency='') %>%
  formatRound(c("RIs_input", "RIs_TFfiltered", "RIs_RIfiltered", "TP", "FP"), digits=0) %>%
  formatRound(c("Sensitivity", "Specificity", "Precision"), digits=3) %>%
  formatStyle('Sensitivity',  background = styleColorBar(range(summary_df$Sensitivity), 'burlywood')) %>%
  formatStyle('Specificity',  background = styleColorBar(range(summary_df$Specificity), 'burlywood')) %>%
  formatStyle('Precision',  background = styleColorBar(range(summary_df$Precision), 'burlywood')) #%>% 
  #formatStyle(  'Set_ID', 'group',  backgroundColor = styleEqual(c("control", "expression", "physical"), c('lightcoral', 'lightgreen', "lightblue")))
```

## Histograms

```{r histograms, eval=TRUE}
cat(paste0("![](", results_dir, "/summary_report/histogram.png)"), "\n")
```

## Upset plot

```{r show-upset, eval=TRUE, fig.width=8, fig.height=4}

cat(paste0("![](", results_dir, "/summary_report/upset.png)"), "\n")

```

# Datasets

```{r case-by-case, eval=TRUE}

for(s in set_ids) {
     cat(paste0("\n## ", s, " {.tabset}"))
     cat(paste0("\n **Stats**\n"))
     
     cat(kable(summary_df %>% filter(Set_ID==s), digits=3, format.args = list(big.mark = ',')) %>% kable_styling(full_width = T, font_size = 12, bootstrap_options = c("striped", "hover")))
  
     confusion <- read.delim(file = paste0(results_dir, "/", s, "/", s, "_confusion_matrix.tsv"), header=T, stringsAsFactors=FALSE)
     rownames(confusion) <- c("predicted_positive", "predicted_negative", "total")
     cat(kable(confusion, digits=3, format.args = list(big.mark = ',')) %>% kable_styling(full_width = T, font_size = 12, bootstrap_options = c("striped", "hover")))
  
     cat(paste0("\n### ROC curve\n"))
     
     cat(paste0("![](", results_dir, "/", s, "/", s, "_roc.png)"), "\n")
     
     cat(paste0("\n### Precision-recall curve\n"))
     
     cat(paste0("![](", results_dir, "/", s, "/", s, "_prc.png)"), "\n")
     
     cat(paste0("\n### Venn diagram\n"))
     
     cat(paste0("![](", results_dir, "/", s, "/", s, "_venn.png)"), "\n")
}
```
